# BLZ (File Format)


## Introduction
**BLZ** is the (custom) file format/extention the editor uses to save projects in. It is custom designed and made for ease of use and so its lightweight/small.
Our file is just json but compressed with a custom compression algorithm, when the file is decompressed the JSON has this model. (*see the codesample below*)

## Datastructure
The decompressed JSON has this model. (*see the codeblock below*)

```json
{
  "projectName": "",
  "projectDescription": "Blueprintz Generator",
  "map": "town",
  "fireworks": [
    {
      "id": "guid",
      "fireworkIndentifier": "PreloadedTube_MrBeats",
      "position": {
        "X": 0,
        "Y": 0,
        "Z": 0
      },
      "rotation": {
        "X": 0,
        "Y": 0,
        "Z": 0,
        "W": 0,
        "IsIdentity": false
      },
      "isKinematic": true
    }
  ],
  "fuses": [
    {
      "id": "guid",
      "idConnectionA": "guidFireworkA",
      "idConnectionB": "guidFireworkB",
      "speed": 1
    }
  ]
}
```

```note
The design of the model is still in progress, and will change in the future!
```

## Algorithm

To compress the JSON you would do the following steps.

1. Convet the encoded JSON to BSON data.
2. Use a Zipping algorithm to further compress the BSON string.
3. Write the bytes generated by the Zipping algorithm to a file.

## Code Samples
In this section are a few codesamples on how to intergrate the algorithm's. These are in pseudo-code.

The code-blocks below contains example-code for compression written in C#.

The BSON generation:
```cs
var obj = JsonConvert.DeserializeObject(json);
JsonSerializer serializer = new JsonSerializer();
MemoryStream stream = new MemoryStream();
BsonWriter writer = new BsonWriter(stream);
serializer.Serialize(writer, obj);
string output = System.Text.Encoding.ASCII.GetString(stream.ToArray());
```
Zipping algorithm:
```cs
public static byte[] Zip(string str)
{
  var bytes = System.Text.Encoding.UTF8.GetBytes(str);
  using (var msi = new MemoryStream(bytes))
  using (var mso = new MemoryStream()
  {
    using (var gs = new GZipStream(mso, CompressionMode.Compress))
    {
       byte[] bytes = new byte[4096];
       int cnt;
       while ((cnt = msi.Read(bytes, 0, bytes.Length)) != 0)
       {
         gs.Write(bytes, 0, cnt);
       }
    }
    return mso.ToArray();
  }
}
```

The following code-blocks contain example-code for decompression written in C#.

```cs
Nothing here yet.
```

Page Contributors: @daanbreur, @jjblock21
